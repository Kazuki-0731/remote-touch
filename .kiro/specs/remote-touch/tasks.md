# Implementation Plan

- [x] 1. iOS: プロジェクト構造とデータモデルのセットアップ
  - lib/配下にディレクトリ構造を作成（models, views, viewmodels, services）
  - Command、StatusData、Device、AppSettings等のデータモデルを実装
  - Codableプロトコルに準拠したJSON シリアライゼーション機能を実装
  - _Requirements: 1.1, 2.1, 4.3, 5.4, 6.3, 7.4, 8.2, 9.1_

- [x] 2. iOS: BLE Central Managerの実装
  - BLECentralManagerクラスを作成してCore Bluetoothを統合
  - デバイススキャン、接続、切断機能を実装
  - GATT サービスとキャラクタリスティックの検出機能を実装
  - コマンド送信とステータス受信のメソッドを実装
  - _Requirements: 4.1, 4.3, 5.1, 5.2, 12.1, 12.2_

- [x] 3. iOS: ジェスチャー処理サービスの実装
  - GestureProcessorクラスを作成
  - スワイプジェスチャーからカーソル移動量を計算するロジックを実装
  - タップ検出（シングル/ダブル）ロジックを実装
  - 感度設定を適用した移動量計算を実装
  - _Requirements: 1.1, 1.4, 2.1, 2.3, 8.4_

- [x] 4. iOS: デバイスストレージサービスの実装
  - DeviceStorageクラスを作成してUserDefaultsを使用
  - デバイス情報の保存、読み込み、削除機能を実装
  - 最大5台の制限ロジックを実装（最古デバイスの自動削除）
  - 設定情報（感度等）の永続化機能を実装
  - _Requirements: 6.1, 6.3, 6.4, 8.2, 8.3_

- [x] 5. iOS: ViewModelレイヤーの実装
  - TouchpadViewModelを作成してジェスチャー処理とBLE通信を統合
  - ConnectionViewModelを作成して接続状態管理を実装
  - 操作モード（プレゼン/メディア/基本マウス）の状態管理を実装
  - アイドル検出ロジックを実装（60秒無操作でスリープ）
  - _Requirements: 1.1, 2.1, 5.1, 5.2, 7.1, 7.2, 7.3, 11.1, 11.2_

- [x] 6. iOS: タッチパッドビューの実装
  - TouchpadViewをSwiftUIで作成
  - タッチパッドエリアのジェスチャー認識（スワイプ、タップ、ダブルタップ）を実装
  - 物理ボタン（←/→）のUIと動作を実装
  - 接続状態とバッテリーレベルの表示を実装
  - _Requirements: 1.1, 2.1, 2.3, 3.1, 3.2, 5.1, 5.2, 5.4_

- [x] 7. iOS: デバイス選択とペアリングビューの実装
  - DeviceListViewをSwiftUIで作成
  - デバイススキャン機能のUIを実装
  - ペアリングコード入力ダイアログを実装
  - 登録済みデバイスリストの表示と選択機能を実装
  - _Requirements: 4.1, 4.3, 6.2, 6.3_

- [x] 8. iOS: モード選択と設定ビューの実装
  - ModeSelectionViewをSwiftUIで作成（プレゼン/メディア/基本マウス）
  - SettingsViewをSwiftUIで作成
  - 感度調整スライダー（0.5〜3.0倍）を実装
  - 登録済みデバイス管理UIを実装
  - _Requirements: 7.1, 7.2, 7.3, 8.1, 8.2_

- [x] 9. iOS: メディアコントロールモードの実装
  - メディアコントロールモード用のコマンド生成ロジックを実装
  - タップで再生/一時停止、上下スワイプで音量調整の機能を実装
  - モード別のUI表示切り替えを実装
  - _Requirements: 9.1, 9.2, 9.3_

- [x] 10. iOS: 自動再接続機能の実装
  - BLE接続切断検出ロジックを実装
  - 5秒間隔で最大10回の再接続試行ロジックを実装
  - 再接続状態のUI表示を実装
  - 再接続失敗時のユーザー通知を実装
  - _Requirements: 12.1, 12.2, 12.3, 12.4_

- [x] 11. macOS: プロジェクト構造とデータモデルのセットアップ
  - macOS Appプロジェクトを作成（AppKit + Swift）
  - Command、StatusData等のデータモデルを実装（iOSと共通）
  - Codableプロトコルに準拠したJSON シリアライゼーション機能を実装
  - _Requirements: 1.2, 2.2, 4.4, 5.3, 7.5, 9.4_

- [x] 12. macOS: BLE Peripheral Managerの実装
  - BLEPeripheralManagerクラスを作成してCore Bluetoothを統合
  - GATT サービスとキャラクタリスティックを定義して登録
  - BLEアドバタイジング機能を実装
  - コマンド受信とステータス送信のメソッドを実装
  - _Requirements: 4.1, 4.2, 5.3_

- [x] 13. macOS: ペアリング機能の実装
  - 6桁のペアリングコード生成ロジックを実装
  - ペアリングコードの画面表示機能を実装
  - ペアリングコード検証ロジックを実装（3回失敗でロックアウト）
  - ペアリング済みデバイスの保存機能を実装
  - _Requirements: 4.2, 4.3, 4.4, 4.5_

- [x] 14. macOS: アクセシビリティ権限管理の実装
  - AccessibilityManagerクラスを作成
  - アクセシビリティ権限チェック機能を実装
  - 権限リクエストダイアログ表示機能を実装
  - システム環境設定を開く機能を実装
  - _Requirements: 10.1, 10.2, 10.3, 10.4_

- [x] 15. macOS: CGEvent APIを使用したイベント生成の実装
  - EventGeneratorクラスを作成
  - カーソル移動機能を実装（CGEvent mouseMoved）
  - クリック/ダブルクリック生成機能を実装
  - キーボードイベント生成機能を実装（矢印キー、Enter、Command等）
  - メディアキーイベント生成機能を実装（再生/一時停止、音量調整）
  - _Requirements: 1.2, 2.2, 3.3, 3.4, 3.5, 3.6, 9.4, 9.5_

- [x] 16. macOS: コマンドプロセッサの実装
  - CommandProcessorクラスを作成
  - 受信したコマンドの解析とEventGeneratorへのディスパッチを実装
  - 操作モード別のコマンド解釈ロジックを実装
  - ボタンアクション（戻る/決定）のモード別処理を実装
  - _Requirements: 3.3, 3.4, 3.5, 3.6, 7.5, 9.4, 9.5_

- [x] 17. macOS: ステータス送信機能の実装
  - バッテリーレベル取得機能を実装（IOKit使用）
  - 2秒ごとのステータス送信ロジックを実装
  - StatusDataのJSON エンコードと送信を実装
  - _Requirements: 5.3, 5.4_

- [x] 18. macOS: メニューバーアプリUIの実装
  - メニューバーアイコンとメニューを実装
  - 接続状態の表示を実装
  - ペアリングコード表示ウィンドウを実装
  - 設定メニュー（アクセシビリティ権限、終了等）を実装
  - _Requirements: 4.2, 10.2_

- [x] 19. エンドツーエンド統合テストの実施
  - iOS AppとmacOS App間のBLE通信を検証
  - ペアリングフローの動作確認
  - 各操作モードでの動作確認（カーソル移動、クリック、ボタン操作）
  - 自動再接続機能の動作確認
  - _Requirements: All_

- [x] 20. エラーハンドリングとエッジケースの実装
  - BLE接続エラー時のリトライロジックを実装
  - 無効なコマンド受信時のエラーハンドリングを実装
  - アクセシビリティ権限なし時の適切なエラー表示を実装
  - デバイスストレージエラー時のフォールバック処理を実装
  - _Requirements: 4.5, 10.2, 10.3, 12.1, 12.2, 12.4_
